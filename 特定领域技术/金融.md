# 金融

金融业包括了银行、保险、证券、信托、基金等几大分支，下面主要以银行为主来介绍。

## 领域系统特点
* 金融业务相关
	* 金融业务繁杂：由于金融业务门槛相对高，对技术人员的业务要求也远高于其他领域。以银行为例，主要包括了资产业务（贷款）、负债业务（存款）、中间业务（银行卡、外币结算、代理等）、客户（ECIF）、支付清算（人行大小额/超网/网联）、前置等，账务遵循会计原则（会计日、科目分录、借贷复式记账、权责发生制等），还要理解联机交易和跑批交易区别，等等
	* 交易检查：一笔交易往往要经过多道金融属性检查，包括渠道、交易类型、限额、账号状态、黑白名单、账户类型、币种等
	* 交易确定周期长：一笔交易要经过多个不同系统，数据在这些系统中得到保存和交叉检验，这个周期较长，如果采取同步方式则极易引发超时，所以往往采取异步方式处理，并通过轮询接口来查证，交易失败启动补偿机制，最后通过对账最终确定 	* 交易可追溯：每笔交易产生的影响都要记录，不能仅记录最终结果，比如对于账户余额，除了记录各个账户当前余额外，还要用余额历史表记录每一次余额的变化。如果要避免交易记录丢失，还可以通过消息队列来缓存。如果存入区块链，则天然具备可追溯性	* 流程控制：对数据的准确性、合规性、安全可控有更高要求，为此需要设计大量的管理后台操作流程，方便对银行各类资源进行管理。管理基于权限实现，而权限一般基于`RBAC(Role-Based Access Control)`来设计	* 新技术接受度：由于对系统稳定性的高要求，加上业务形态变化并不快，所以金融领域对新技术的接受度谨慎且缓慢。但同时看到，得益于数据量爆发和新一代金融科技公司的崛起，区块链等新技术纷纷在金融领域率先落地* 开发效率
	* 高扩展性：主要针对IT技术服务提供商和金融科技公司，他们往往为多个银行提供一套比较通用的解决方案，所以要寻找不同银行在技术要求上的共性和差异，为共性打造复用空间，为差异预留扩展空间		* 支持SaaS或本地化部署		* 支持单机构独立部署或多机构混布
		* 接入和接出不同关联方：这部分工作繁琐耗时，往往占到整个开发周期的30%以上，为了提高效率，要研发一套适配系统，实现对不同关联方协议、参数转化、数据格式的适配
		* 适配不同主流数据库
* 资源管理能力
	* 定时任务多：由于交易确定周期长，需要加入不少异步设计，往往相应地引入定时任务。一般需要通过分布式调度中心实现对大规模定时任务的管理
* 数据
	* 数据强一致性：在支付、赎回、跑批等核心交易场景下，CAP原则中更偏向于C，为此要用到分布式锁或分布式事务（TCC/FMT/XA模型）等同步机制
* 安全
	* 应用安全：加密加签、防重放、防重复交易、敏感字段加密脱敏、防DDoS/CSRF等常规攻击、身份认证/授权/审计
	* 数据安全：数据库/Log敏感字段加密脱敏、密码硬件加密、文件加密存储、不同机构数据物理隔离、反欺诈、操作留痕记录
	* 网络安全：网络分区（DMZ/SF/PTR）、专线传输	* 风险控制：风控实现既定的损失目标下的收益最大化，用于多种金融业务。以贷款为例，风控模型公式要实现`LOSS<=目标`，其中`LOSS=∑ PDi*EADi*LGDi`，PD(Probability of Default)是违约概率、EAD(Exposure at Default)是违约风险敞口、LGD(Loss Given Default)是违约损失率，这些参数由欺诈管理、还款能力、还款意愿、还款能力和意愿的稳定性、贷后管理等数据计算所得
	* 强监管：面向监管机构（一行两会/外管局/财政部/本地监管部门），提供投诉通道、监视能力；面向被监管机构，提供自查能力。一般在跑批交易中将关键数据写入文件，方便监管使用	* 多以文件形式批量同步数据：由于不同关联系统间的差异，数据同步难以实时完成，一般采用文件形式将一段时间内的数据进行定时传输同步

## 非传统银行企业的金融科技服务
### 传统银行组建的信科企业
有非常完整的银行业务系统，向上能够对接线上（手机银行等）、线下（柜面等）、第三方（人行系统等）全渠道，向下能够对接多家金融机构。

与银行传统系统在架构上差别不大，对接成本相对低。技术上，对开源技术和新技术标准较保守：去IOE不彻底；采用虚拟化技术，一般不采用容器；兼容jsp，有大量的xml。

### 金融领域IT技术服务提供商/技术外包商
这类公司包括神州数码、文思海辉、恒生电子、长亮科技、东软、汉得等，在银行金融业深耕多年，有大量的银行客户，有非常完整的银行核心业务系统。

技术上紧随市场，拥抱开源技术，关键技术和对应的元问题：服务化（研发效率）、分布式（可用性）、异步（性能）、缓存（性能）、流控（可用性）、集群（可用性）、虚拟化（资源使用效率）、海量数据处理（基于RMDB处理结构化数据）、大数据处理（基于NoSQL处理非结构化数据）。

出于成本和场景的限制，他们使用的都是非常成熟的开源技术，几乎不使用新技术，也不对开源技术做定制化修改。好处是成本小，隐患是无技术壁垒、难以快速响应场景或业务的变化（新技术面向的都是可期的未来场景或业务），导致可替代性高。

不同公司的经营策略有所不同：

* 系统集成：将国内外的各类银行产品为客户搭建起来，并集成到银行老系统上。通过系统集成，营收涨得快，但是毛利不高。这里的代表是神州数码
* 软件开发：这是大部分属于劳动密集型工作，主要针对不同客户的需求做定制化开发，很难输出一套标准。这里主要是东软、中软的地盘
* 代理实施：基于国外产品进行包装和实施。汉得属于这一种

### 数据服务商
数据服务商主要解决传统银行的数据元问题。传统银行系统诞生于DT数据时代之前，大多不具备对数据的处理能力，需要依靠数据服务商完成对行内数据的存储、处理、挖掘。

TalkingData是代表企业之一，提供了包括统计系统和数据营销系统在内的一系列数据平台：

* 数据统计系统：定义了两个概念，一个是维度（一个维度是一个任意若干个字段组合），一个是度量（包括各种类SQL的计算类型：count、sum、group by等）。这样的设计十分友好，无需技术人员，产品团队就可以用来做数据统计，他们只需配置各种数据维度并指定合适的度量计算，就能得到常用的数据统计结果（比如uv、pv等）
* 数据营销系统（获客）：基于标签的预测，根据个人信息、交易行为、出行、购物等历史数据，为每个用户打标签，以标签集合作为特征向量训练出一套标签关联度模型，用以预测用户未来在符合某些标签时的行为

### 互联网银行
互联网银行是一种新型的银行，一般不设置线下网点，所有业务全部搬到线上。

微众银行是其代表之一，基于大量的腾讯技术完成新一代面向互联网的分布式银行系统，其主要解决的元问题包括：

* 伸缩性：以客户为单位的可控分布，一个客户的所有信息都在同一个数据节点上（这里的节点是逻辑部署单位，并非物理机器，每个节点都有备节点），设计一个GNS（全局命名服务）为每个新客户分配节点。随着客户数增加，采用scale out增加数据节点，随着交易频率上升单个客户数据增加，采用scale up增加单个节点资源
* 数据：基于TDSQL，一套腾讯自研的基于mysql的分布式数据库
* 安全：WeBank信息安全体系，包括应用安全、网络安全、数据安全、主机安全

### 金融科技公司
这类公司主营互联网金融业务，为传统银行提供流量渠道。中小型金融科技公司包括宜人贷、点融等，大型金融科技公司包括蚂蚁金服、京东数科、平安陆金所等。

这类公司在开源技术上相对开放很多，不光大量采用开源技术和二次开发开源技术，大型金融科技公司甚至输出不少自研开源技术。整体而言，这类公司系统更关注开发效率、数据、安全、可用性四个元问题。

