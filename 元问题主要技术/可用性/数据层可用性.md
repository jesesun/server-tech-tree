# 数据层可用性

* 主备：备节点正常情况不接流量，一旦主节点挂了，切到备节点进行服务。数据层的备节点要做好与主节点的同步，应用层是无状态的，无需同步。热备份是实时备份，冷备份则是周期性备份，发生主备切换时，备节点数据不是最新的
* 一主一从一灾备：这是常见数据引擎的架构，主从在同城，灾备在异地，同步延迟时间视情况而定
* 双活：两个节点集群都接流量，但按指定路由规则接流量，比如按用户ID分接流量。一旦某个节点集群挂了，其流量无缝切换到另一个节点集群。双活3个要求：1、流量按路由分派到不同节点集群；2、一个请求在一个节点集群闭环，不能跨到另一个节点集群去；3、数据能够分片访问。这样一来，双活能保证一个节点集群只写属于它的数据分片，单向同步另一个节点集群的数据分片，避免两个节点集群会相互更新彼此数据分片，数据一致性的技术成本将大增
  * MySQL：MHA、PXC
* 多活：节点集群数>2的双活升级版
* 物理隔离：同城 vs 异地。主备、双活、多活等都可以基于同城或异地
* 两地三中心：同城双活+异地多活
* 云计算
 * 私有云、公有云
 * 混合云：私有云和公有云混搭
 * 多云：部署在多个厂商的公有云或多个厂商的私有云，避免锁死在一个云厂商，需要实现统一管理
 * 定期演练


## 集群容错机制

* failover：失效转移
Fail-Over的含义为“失效转移”，是一种备份操作模式，当主要组件异常时，其功能转移到备份组件。其要点在于有主有备，且主故障时备可启用，并设置为主。如Mysql的双Master模式，当正在使用的Master出现故障时，可以拿备Master做主使用

* failback：失效自动恢复
Fail-over之后的自动恢复，在簇网络系统（有两台或多台服务器互联的网络）中，由于要某台服务器进行维修，需要网络资源和服务暂时重定向到备用系统。在此之后将网络资源和服务器恢复为由原始主机提供的过程，称为自动恢复

* failfast：快速失败
从字面含义看就是“快速失败”，尽可能的发现系统中的错误，使系统能够按照事先设定好的错误的流程执行，对应的方式是“fault-tolerant（错误容忍）”。以JAVA集合（Collection）的快速失败为例，当多个线程对同一个集合的内容进行操作时，就可能会产生fail-fast事件，例如当某线程A通过iterator去遍历非线程安全的集合过程中，该集合的内容被其他线程改变，那么线程A访问集合时，就会抛出ConcurrentModificationException异常（发现错误执行设定好的错误的流程），产生fail-fast事件

* failsafe：失效安全
Fail-Safe的含义为“失效安全”，如果出现故障可以忽略，保证系统仍然可用。fail-safe里的故障需要是在可接受范围内。仍然以Java为例，使用线程安全的集合（比如ConcurrentHashMap）进行iterator遍历和删除，不会抛出异常，但要付出的代价是需要额外空间来拷贝数据，而且不保证遍历得到的结果是最新的（这算是一种故障）
