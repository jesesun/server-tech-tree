# 数据的一致性设计
## CAP
* CAP 定理关注的是对数据的读写操作，而不是分布式系统的所有功能，它要求分布式系统节点间是互相连接且有数据共享的，例如 Memcache 的集群中节点相互间没有连接和数据共享，因此不是 CAP 定理讨论的对象，同理 ZooKeeper 的选举机制也不是 CAP 探讨的对象。
* cap：一致性属于数据；可用性；网络分区容错属于?
## BASE
## 锁
* 追求性能->多线程并发->数据一致性问题->锁和分布式锁

## 一致性算法
![数据一致性方案](http://upload-images.jianshu.io/upload_images/2119886-ec896ce10581bc1a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1080/q/50)
* 常用的一致性算法：raft、paxos、pow等
 * pow解决了共识问题（数据可信同步），还解决了双花问题？
 * 区块链SVP什么场景下用到?拜占庭将军问题如何解决，为何raft和paxio不能解决?
 * ZooKeeper 通过 zab(Paxos简化版) 选举算法实现数据强一致性(zk是多主，即所有节点都存全量数据)，这样一来zk本身就避免了脑裂，就可以充当其他系统主从的裁判了 (即zk保存谁是主谁是从，主失去心跳则从可以换成主)，如果zk这个角色无法避免脑裂，整个系统(无论zk还是主从系统)都会有脑裂问题，元数据不一致，元数据出错会引发各种严重问题，比如下游数据不一致、数据错误、应用执行失败
* 脑裂问题

* 默克尔树
 * 数据完整性或一致性校验的方法
 * btc有一个，etc有三个，见极客
![默克尔树](https://github.com/star2478/server-tech-tree/blob/master/img/blockchain-merkletree.png)

* CAP
 * “在网络发生阻断（partition）时，你只能选择数据的一致性（consistency）或可用性（availability），无法两者兼得”。论点比较直观：如果网络因阻断而分隔为二，在其中一边我送出一笔交易：“将我的十元给 A”；在另一半我送出另一笔交易：“将我的十元给 B ”。此时系统要么是，a）无可用性，即这两笔交易至少会有一笔交易不会被接受；要么就是，b）无一致性，一半看到的是 A 多了十元而另一半则看到 B 多了十元。要注意的是，CAP 理论和扩展性（scalability）是无关的，在分片（sharded）或非分片的系统皆适用